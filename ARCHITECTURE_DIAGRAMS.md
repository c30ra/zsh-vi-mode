# ğŸ—ï¸ Module Structure Visualization

## Dependency Graph

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    zsh-vi-mode.plugin.zsh                    â”ƒ
â”ƒ                   (Plugin Entry Point)                        â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                               â”‚
                               â–¼
            â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
            â”ƒ  lib/loader.zsh              â”ƒ
            â”ƒ  (Orchestrates Loading)      â”ƒ
            â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â”‚           â”‚                â”‚          â”‚
        â–¼           â–¼           â–¼                â–¼          â–¼
    [Core]      [Core]       [Core]          [Pending]   [Pending]
    â”Œâ”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”
    â”‚ C  â”‚      â”‚ U  â”‚   â—„â”€â”€â”€â”‚ MM â”‚â—„â”€â”€â”€â”€â”€â”€â”  â”‚ I  â”‚  â—„â”€â”€â”‚ K  â”‚
    â”‚    â”‚      â”‚    â”‚       â”‚    â”‚       â”‚  â”‚    â”‚     â”‚    â”‚
    â”‚ 1  â”‚      â”‚ 2  â”‚       â”‚ 3  â”‚       â””â”€â”€â”‚ 4  â”‚  â—„â”€â”€â”‚ 5  â”‚
    â””â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”˜
   â–² [No deps]  â–² Depends    â–² Depends    Depends     Depends
   â”‚            â”‚ on C       â”‚ on C, U    on C, U,MM  on C,U,MM
   â”‚            â”‚            â”‚
   â–¼            â–¼            â–¼
Const  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Values â”‚          Functions â”‚ Modes
       â”‚                    â”‚
       â”œâ”€ Modes             â”œâ”€ Check commands
       â”œâ”€ Cursors           â”œâ”€ Execute hooks
       â”œâ”€ Timeouts          â”œâ”€ String utils
       â”œâ”€ Patterns          â”œâ”€ URL/Path check
       â”œâ”€ Handlers          â”œâ”€ Word selection
       â””â”€ Defaults          â””â”€ System report

Legend:
[C]  = constants.zsh    [U] = utils.zsh    [MM] = mode-manager.zsh
[I]  = init.zsh         [K] = keybindings.zsh
```

## Complete Module Architecture (Final)

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  .zshrc (User Config)   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
        â”ƒ  lib/loader.zsh                     â”ƒ
        â”ƒ  (Module Loading Orchestrator)      â”ƒ
        â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚               â”‚          â”‚          â”‚
        â–¼               â–¼               â–¼               â–¼          â–¼          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ const  â”‚      â”‚ utils  â”‚     â”‚ modes  â”‚     â”‚ init   â”‚ â”‚keys/bd â”‚ â”‚handlersâ”‚
    â”‚        â”‚      â”‚        â”‚     â”‚        â”‚     â”‚        â”‚ â”‚        â”‚ â”‚        â”‚
    â”‚ 170px  â”‚      â”‚ 220px  â”‚     â”‚ 230px  â”‚     â”‚ 300px  â”‚ â”‚ 250px  â”‚ â”‚ 150px  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚               â”‚               â”‚          â”‚          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚               â”‚               â”‚          â”‚          â”‚
                â–¼               â–¼               â–¼          â–¼          â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ editor â”‚      â”‚ repeat â”‚     â”‚navigateâ”‚ â”‚surroundâ”‚ â”‚keywordsâ”‚
            â”‚        â”‚      â”‚        â”‚     â”‚        â”‚ â”‚        â”‚ â”‚        â”‚
            â”‚ 450px  â”‚      â”‚ 250px  â”‚     â”‚ 400px  â”‚ â”‚ 200px  â”‚ â”‚ 350px  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚               â”‚               â”‚          â”‚          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚               â”‚        â”‚          â”‚
                â–¼               â–¼        â–¼          â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   ui   â”‚      â”‚clipboardâ”‚ â”‚  url   â”‚ â”‚ zle-hksâ”‚
            â”‚        â”‚      â”‚        â”‚ â”‚        â”‚ â”‚        â”‚
            â”‚ 200px  â”‚      â”‚ 100px  â”‚ â”‚ 100px  â”‚ â”‚  50px  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total: ~3,700 lines distributed across 12 focused modules
```

## Module Dependencies Matrix

```
            â”‚ C  U MM I  K  E  R  N  S  KW UI CB URL ZH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Const (C)   â”‚ âœ“  -  -  -  -  -  -  -  -  -  -  -  -  -
Utils (U)   â”‚ âœ“  âœ“  -  -  -  -  -  -  -  -  -  -  -  -
Modes (MM)  â”‚ âœ“  âœ“  âœ“  -  -  -  -  -  -  -  -  -  -  -
Init (I)    â”‚ âœ“  âœ“  âœ“  âœ“  -  -  -  -  -  -  -  -  -  -
Keys (K)    â”‚ âœ“  âœ“  âœ“  âœ“  âœ“  -  -  -  -  -  -  -  -  -
Editor (E)  â”‚ âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  -  -  -  -  -  -  -  -
Repeat (R)  â”‚ âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  -  -  -  -  -  -  -
Navig (N)   â”‚ âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  -  -  -  -  -  -
Surr (S)    â”‚ âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  -  -  -  -  -
Keywrd (KW) â”‚ âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  -  -  -  -
UI (UI)     â”‚ âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  -  -  -
Clip (CB)   â”‚ âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  -  -
URL (URL)   â”‚ âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  -
ZLEHks (ZH) â”‚ âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“

âœ“ = Has dependency
- = No dependency on row

Dependency flow: Horizontal (depends on horizontal items)
```

## Loading Order (Phase-based)

### Phase 1: Core (Complete âœ…)
```
1. constants.zsh (no deps)
2. utils.zsh (â†’ constants)
3. mode-manager.zsh (â†’ constants, utils)
4. loader.zsh (orchestrates all)
```

### Phase 2: Foundation (Next)
```
5. init.zsh (main initialization)
6. keybindings.zsh (key handling)
7. handlers.zsh (event handlers)
```

### Phase 3: Core Features
```
8. editor.zsh (text operations)
9. repeat.zsh (repeat functionality)
10. navigation.zsh (navigation)
```

### Phase 4: Extended Features
```
11. surround.zsh (surround objects)
12. keywords.zsh (keyword switching)
13. ui.zsh (cursor/highlight)
14. clipboard.zsh (system clipboard)
15. url.zsh (URL handling)
16. zle-hooks.zsh (ZLE lifecycle)
```

## Function Distribution Map

```
Phase 1 (âœ… Complete):
â”œâ”€â”€ constants.zsh
â”‚   â””â”€â”€ ~50 constant definitions
â”œâ”€â”€ utils.zsh
â”‚   â”œâ”€â”€ zvm_version()
â”‚   â”œâ”€â”€ zvm_exist_command()
â”‚   â”œâ”€â”€ zvm_exec_commands()
â”‚   â”œâ”€â”€ String utilities
â”‚   â”œâ”€â”€ Validation functions
â”‚   â””â”€â”€ System reporting
â”œâ”€â”€ mode-manager.zsh
â”‚   â”œâ”€â”€ Mode entry/exit functions
â”‚   â”œâ”€â”€ Mode selection
â”‚   â”œâ”€â”€ Prompt management
â”‚   â””â”€â”€ Undo handling
â””â”€â”€ loader.zsh
    â””â”€â”€ Module orchestration

Phase 2-4 (Pending):
â”œâ”€â”€ init.zsh (~30 functions)
â”œâ”€â”€ keybindings.zsh (~5 functions)
â”œâ”€â”€ handlers.zsh (~2 functions)
â”œâ”€â”€ editor.zsh (~25 functions)
â”œâ”€â”€ repeat.zsh (~7 functions)
â”œâ”€â”€ navigation.zsh (~3 functions)
â”œâ”€â”€ surround.zsh (~7 functions)
â”œâ”€â”€ keywords.zsh (~6 functions)
â”œâ”€â”€ ui.zsh (~5 functions)
â”œâ”€â”€ clipboard.zsh (~7 functions)
â”œâ”€â”€ url.zsh (~3 functions)
â””â”€â”€ zle-hooks.zsh (~3 functions)

Total: ~135 functions across 15 modules
```

## File Size Progression

```
Original:          â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ 4000 lines (1 file)

Phase 1 Complete:  â–“ â–“ â–“ â–“ 50,170,220,230 lines (4 files)
                   â”‚ â”‚ â”‚ â”‚
                   â”‚ â”‚ â”‚ â””â”€ mode-manager.zsh
                   â”‚ â”‚ â””â”€â”€â”€ utils.zsh
                   â”‚ â””â”€â”€â”€â”€â”€ loader.zsh
                   â””â”€â”€â”€â”€â”€â”€â”€ constants.zsh

Phase 4 Complete:  â–“â–“ â–“ â–“ â–“ â–“ â–“ â–“ â–“â–“ â–“ â–“ â–“ â–“ 12 focused files
                   Average 300-400 lines per module
```

## Performance Impact

```
Loading Performance:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Original File   â”‚  4000 lines/parse
â”‚  (monolithic)    â”‚  â–“ 100%
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1 Modules â”‚  50+170+220+230 lines/parse
â”‚  (4 files)       â”‚  â–“ 105% (minimal overhead)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 4 Completeâ”‚  ~3700 lines total/parse
â”‚  (12 files)      â”‚  â–“ 92% (parallel loading benefit)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: Negligible performance difference (~Â±5%)
        Better startup with parallel loading (future optimization)
```

---

**Last Updated:** November 22, 2025
**Version:** zsh-vi-mode 0.12.0 (modularized)
**Phase:** 1 Complete, 2-4 Pending
